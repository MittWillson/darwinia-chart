{{- include "common.values.setup" . }}

{{- define "davalid.command" -}}
{{- $runtime := .Values.config.runtime | default "darwinia" -}}
{{- $mode := .Values.config.mode | default "node" -}}
{{- $isValidator := eq $mode "validator" }}
command: ["darwinia"]
args:
  - "--base-path"
  - "/data"
  - "--rpc-port"
  - "9933"
  - "--ws-port"
  - "9944"
  - "--name"
  - {{ include "davalid.runnerName" . | quote }}
  {{- if $runtime }}
  - "--chain"
  - {{ $runtime | quote }}
  {{- end }}
  {{- if $isValidator }}
  - "--unsafe-rpc-external"
  - "--rpc-methods"
  - "Auto"
  - "--validator"
  {{- end }}
  {{- if and (not $isValidator) .Values.config.external }}
  - "--rpc-external"
  - "--ws-external"
  - "--rpc-cors"
  - "all"
  {{- end }}
  {{- if .Values.config.targetGasPrice }}
  - "--target-gas-price"
  - {{ .Values.config.targetGasPrice | quote }}
  {{- end }}
  {{- if .Values.config.peers }}
  - "--out-peers"
  - {{ .Values.config.peers | quote }}
  {{- end }}
  {{- range $arg := .Values.args }}
  - {{ $arg | quote }}
  {{- end }}
{{- end -}}

{{- $_ := merge .Values (include "davalid.command" . | fromYaml) -}}
{{ include "common.all" . }}